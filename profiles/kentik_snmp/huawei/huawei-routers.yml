# https://www.circitor.fr/Mibs/Html/H/HUAWEI-BGP-VPN-MIB.php
# https://www.circitor.fr/Mibs/Html/H/HUAWEI-DNS-MIB.php
# https://www.circitor.fr/Mibs/Html/H/HUAWEI-NAT-EXT-MIB.php
# http://www.mibdepot.com/cgi-bin/vendor_index.cgi?r=huawei
---
extends:
  - huawei-all-devices.yml

sysobjectid:
  - 1.3.6.1.4.1.2011.2.224.279    # Huawei AR651-X8

provider: kentik-router

metrics:
  # BGP metrics are tagged to match the bgp4-mib.yml values
  # BGP Peer Table. This table contains information about the connections for BGP peers. 
  - MIB: HUAWEI-BGP-VPN-MIB
    table:
      name: hwBgpPeerTable
      OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2
    symbols:
      # The version negotiated with the remote BGP peer.
      - name: hwBgpPeerNegotiatedVersion
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.1 = GAUGE32: 4
        tag: bgpPeerNegotiatedVersion
      # The AS number of the remote BGP peer.
      - name: hwBgpPeerRemoteAs
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.2 = GAUGE32: 64518
        tag: bgpPeerRemoteAs
      # The status of the remote BGP peer.
      - name: hwBgpPeerState
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.5 = INTEGER: 6
        enum:
          idle: 1
          connect: 2
          active: 3
          openSsent: 4
          openconfirm: 5
          established: 6
        tag: bgpPeerState
      # The Counter That Records the Times the Remote BGP Peer Is Correctly Connected The counter is increased by one if the remote BGP peer is correctly connected once. The counter could be set to zero.
      - name: hwBgpPeerFsmEstablishedCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.6 = GAUGE32: 12
        tag: bgpPeerFsmEstablishedTransitions
      # The counter that records the times the remote BGP peer is correctly connected.
      - name: hwBgpPeerFsmEstablishedTime
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.7 = GAUGE32: 29581182
        tag: bgpPeerFsmEstablishedTime
      # Bgp peer down reason
      - name: hwBgpPeerUnAvaiReason
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.10 = GAUGE32: 0
        enum:
          configurationLeadPeerDown: 1
          receiveNotification: 2
          receiveErrorPacket: 3
          holdTimerExpire: 4
          remotePeerNotReachable: 5
          directConnectInterfaceDown: 6
          routeLimit: 7
    metric_tags:
      # The name of the VPN instance.
      - column:
          name: hwBgpPeerVrfName
          OID: 1.3.6.1.4.1.2011.5.25.177.1.1.1.1.6 = STRING: "DSVPN"
      # The IP address of the remote BGP peer.
      - column:
          name: hwBgpPeerRemoteAddr
          OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.4 = STRING: "10.12.0.103"
          tag: neighbor_ip
          conversion: hextoip
  # BGP metrics are tagged to match the bgp4-mib.yml values
  # Route table for BGP Peers This table contains routing information about the BGP peers.
  - MIB: HUAWEI-BGP-VPN-MIB
    table:
      name: hwBgpPeerRouteTable
      OID: 1.3.6.1.4.1.2011.5.25.177.1.1.3
    symbols:
      # The number of prefixes received from the remote BGP peer.
      - name: hwBgpPeerPrefixRcvCounter
       OID: 1.3.6.1.4.1.2011.5.25.177.1.1.3.1.1 = COUNTER32: 29
      # The number of active prefixes received from the remote BGP peer.
      - name: hwBgpPeerPrefixActiveCounter
       OID: 1.3.6.1.4.1.2011.5.25.177.1.1.3.1.2 = COUNTER32: 27
      # The number of prefixes sent to the remote BGP peer.
      - name: hwBgpPeerPrefixAdvCounter
       OID: 1.3.6.1.4.1.2011.5.25.177.1.1.3.1.3 = COUNTER32: 3
    metric_tags:
      # The name of the VPN instance.
      - column:
          name: hwBgpPeerVrfName
          OID: 1.3.6.1.4.1.2011.5.25.177.1.1.1.1.6 = STRING: "DSVPN"
      # The IP address of the remote BGP peer.
      - column:
          name: hwBgpPeerRemoteAddr
          OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.4 = STRING: "10.12.0.103"
          tag: neighbor_ip
          conversion: hextoip
  # BGP metrics are tagged to match the bgp4-mib.yml values
  # Protocol Packet Table for BGP Peers This table contains information about the protocol packets of BGP peers.
  - MIB: HUAWEI-BGP-VPN-MIB
    table:
      name: hwBgpPeerMessageTable
      OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4
    symbols:
      # The total number of protocol packets received from the remote BGP peer.
      - name: hwBgpPeerInTotalMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.1 = COUNTER32: 2954871
        tag: bgpPeerInTotalMessages
      # The total number of protocol packets sent to the remote BGP peer.
      - name: hwBgpPeerOutTotalMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.2 = COUNTER32: 2956932
        tag: bgpPeerOutTotalMessages
      # The total number of Open packets received from the remote BGP peer.
      - name: hwBgpPeerInOpenMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.3 = COUNTER32: 1
      # The total number of Update packets received from the remote BGP peer.
      - name: hwBgpPeerInUpdateMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.4 = COUNTER32: 23
        tag: bgpPeerInUpdates
      # The total number of Notification packets received from the remote BGP peer.
      - name: hwBgpPeerInNotificationMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.5 = COUNTER32: 0
      # The total number of Keepalive packets received from the remote BGP peer.
      - name: hwBgpPeerInKeepAliveMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.6 = COUNTER32: 2954847
      # The total number of Route-Refresh packets received from the remote BGP peer.
      - name: hwBgpPeerInRouteFreshMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.7 = COUNTER32: 0
      # The total number of Open packets sent to the remote BGP peer.
      - name: hwBgpPeerOutOpenMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.8 = COUNTER32: 1
      # The total number of Update packets sent to the remote BGP peer.
      - name: hwBgpPeerOutUpdateMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.9 = COUNTER32: 7
        tag: bgpPeerOutUpdates
      # The total number of Notification packets sent to the remote BGP peer.
      - name: hwBgpPeerOutNotificationMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.10 = COUNTER32: 0
      # The total number of Keepalive packets sent to the remote BGP peer.
      - name: hwBgpPeerOutKeepAliveMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.11 = COUNTER32: 2956924
      # The total number of Route-Refresh packets sent to the remote BGP peer.
      - name: hwBgpPeerOutRouteFreshMsgCounter
        OID: 1.3.6.1.4.1.2011.5.25.177.1.1.4.1.12 = COUNTER32: 0
    metric_tags:
      # The name of the VPN instance.
      - column:
          name: hwBgpPeerVrfName
          OID: 1.3.6.1.4.1.2011.5.25.177.1.1.1.1.6 = STRING: "DSVPN"
      # The IP address of the remote BGP peer.
      - column:
          name: hwBgpPeerRemoteAddr
          OID: 1.3.6.1.4.1.2011.5.25.177.1.1.2.1.4 = STRING: "10.12.0.103"
          tag: neighbor_ip
          conversion: hextoip
  # This table is a list of domain names mapped to IPv4 addresses.
  - MIB: HUAWEI-DNS-MIB
    table:
      name: hwDnsHostsDynamicTable
      OID: 1.3.6.1.4.1.2011.5.25.194.1.1
    symbols:
      # DnsTtl indicates the TTL of a mapping entry, which is a 32-bit integer,in seconds.
      - name: hwDnsTtl
        OID: 1.3.6.1.4.1.2011.5.25.194.1.1.1.3 = INTEGER: 1113
    metric_tags:
      # DnsDomainName indicates a domain name.
      - column:
          name: hwDnsDomainName
          OID: 1.3.6.1.4.1.2011.5.25.194.1.1.1.1 = STRING: "time1.google.com"
      # DnsIpAddress indicates an IP address mapped to a domain name.
      - column:
          name: hwDnsIpAddress
          OID: 1.3.6.1.4.1.2011.5.25.194.1.1.1.2 = IPADDRESS: 216.239.35.0
          conversion: hextoip
      # DnsAlias indicates a domain name alias.
      - column:
          name: hwDnsAlias
          OID: 1.3.6.1.4.1.2011.5.25.194.1.1.1.4 = STRING: ""
  # This table is a list of server addresses.
  - MIB: HUAWEI-DNS-MIB
    table:
      name: hwDnsServerAddrTable
      OID: 1.3.6.1.4.1.2011.5.25.194.1.4
    symbols:
      # hwServerStatus indicates the status of server address.
      - name: hwServerStatus
        OID: 1.3.6.1.4.1.2011.5.25.194.1.4.1.2 = INTEGER: 1
        enum:
          static: 1
          dynamic: 2
    metric_tags:
      # hwServerAddr indicates a server address.
      - column:
          name: hwServerAddr
          OID: 1.3.6.1.4.1.2011.5.25.194.1.4.1.1 = IPADDRESS: 8.8.4.4
          conversion: hextoip
  # Table of detailed data for network events. The agent may choose to delete the instances of hwFwBasicEventsEntry as required because of lack of memory.
  - MIB: HUAWEI-FIREWALL-MIB
    table:
      name: hwFwNetEventsTable
      OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4
    symbols:
      # The interface index most closely associated with this event.
      - name: hwFwNetEventInterface
        OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4.1.2 = INTEGER: 3
        conversion: to_one
      # This object indicates the VRF's name.
      - name: hwFwNetEventSrcVrfName
        OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4.1.3 = STRING: "DSVPN"
        conversion: to_one
      # Source IP address in the IP packet that caused the event.
      - name: hwFwNetEventSrcIpAddress
        OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4.1.4 = IPADDRESS: 203.97.2.78
        conversion: hextoip
      # Destination IP address in the IP packet that caused the event.
      - name: hwFwNetEventDstIpAddress
        OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4.1.7 = IPADDRESS: 45.155.205.43
        conversion: hextoip
      # Source UDP/TCP port in the IP packet that caused the event. 
      - name: hwFwNetEventSrcIpPort
        OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4.1.9 = INTEGER: 0
        conversion: to_one
      # Destination UDP/TCP port in the IP packet that caused the event. 
      - name: hwFwNetEventDstIpPort
        OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4.1.11 = INTEGER: 0
        conversion: to_one
      # A detailed description of the event.
      - name: hwFwNetEventDescription
        OID: 1.3.6.1.4.1.2011.5.25.222.1.1.2.4.1.16 = STRING: "trace-route attack"
        conversion: to_one
  # Table of firewall statistic instances.
  - MIB: HUAWEI-FIREWALL-MIB
    table:
      name: hwFwConnectionStatTable
      OID: 1.3.6.1.4.1.2011.5.25.222.1.2.2.2
    symbols:
      # This is an integer that contains the value of the resource statistic.
      - name: hwFwConnectionStatCount
        OID: 1.3.6.1.4.1.2011.5.25.222.1.2.2.2.1.4 = COUNTER32: 3247489
    metric_tags:
      # A detailed textual description of this statistic.
      - column:
          name: hwFwConnectionStatDescription
          OID: 1.3.6.1.4.1.2011.5.25.222.1.2.2.2.1.3 = STRING: " Icmp totalOpen"
  # Table of NAT address pool instances.
  - MIB: HUAWEI-NAT-EXT-MIB
    table:
      name: hwNatAddrPoolTable
      OID: 1.3.6.1.4.1.2011.5.25.226.2.3.2
    symbols:
      # Number of times the NAT address pool is referenced.
      - name: hwNatAddrPoolRefTimes
        OID: 1.3.6.1.4.1.2011.5.25.226.2.3.2.1.4 = GAUGE32: 0
    metric_tags:
      # Start IP address of the NAT address pool.
      - column:
          name: hwNatAddrPoolStartAddr
          OID: 1.3.6.1.4.1.2011.5.25.226.2.3.2.1.2 = IPADDRESS: 203.97.2.78
          conversion: hextoip
      # End IP address of the NAT address pool.
      - column:
          name: hwNatAddrPoolEndAddr
          OID: 1.3.6.1.4.1.2011.5.25.226.2.3.2.1.3 = IPADDRESS: 203.97.2.78
          conversion: hextoip
      # Mode of referencing the NAT address pool,
      - column:
          name: hwNatAddrPoolRefType
          OID: 1.3.6.1.4.1.2011.5.25.226.2.3.2.1.5 = INTEGER: 0
          enum:
            none: 0
            pat: 1
            noPat: 2
  # Table of NAT session instances.
  - MIB: HUAWEI-NAT-EXT-MIB
    table:
      name: hwNatSessionTable
      OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2
    symbols:
      # The local source ip of the nat session table.
      - name: hwNatSessionSrcLocalAddr
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.1 = IPADDRESS: 10.12.0.61
        conversion: hextoip
      # The local destination ip of the nat session table.
      - name: hwNatSessionDstLocalAddr
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.2 = IPADDRESS: 52.98.8.34
        conversion: hextoip
      # The local source port of the nat session table.
      - name: hwNatSessionSrcLocalPort
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.3 = INTEGER: 51784
      # The local destination port of the nat session table.
      - name: hwNatSessionDstLocalPort
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.4 = INTEGER: 443
      # The protocol of the nat session.
      - name: hwNatSessionProtocol
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.5 = INTEGER: 4
        enum:
          other: 1
          icmp: 2
          udp: 3
          tcp: 4
      # The global source ip of the nat session table.
      - name: hwNatSessionSrcGlobalAddr
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.6 = IPADDRESS: 203.97.2.78
        conversion: hextoip
      # The global destination ip of the nat session table.
      - name: hwNatSessionDstGlobalAddr
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.7 = IPADDRESS: 0.0.0.0
        conversion: hextoip
      # The global source port of the nat session table.
      - name: hwNatSessionSrcGlobalPort
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.8 = INTEGER: 15583
      # The global destination port of the nat session table.
      - name: hwNatSessionDstGlobalPort
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.9 = INTEGER: 0
      # The source VPN instance name of the nat session table.
      - name: hwNatSessionSrcVPN
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.10 = STRING: " "
        conversion: to_one
      # The destination VPN instance name of the nat session table.
      - name: hwNatSessionDstVPN
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.11 = STRING: "      "
        conversion: to_one
      # The NAT session table row status.
      - name: hwNatSessionStatus
        OID: 1.3.6.1.4.1.2011.5.25.226.2.14.2.1.12 = INTEGER: 1
        enum:
          active: 1
          notInService: 2
          notReady: 3
          createAndGo: 4
          createAndWait: 5
          destroy: 6
